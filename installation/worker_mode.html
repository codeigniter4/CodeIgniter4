<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Worker Mode &mdash; CodeIgniter 4.7.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/citheme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/citheme_dark.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/js/citheme.js"></script>
        <script src="../_static/js/carbon.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="Running Your App" href="running.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/ci-logo-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Welcome to CodeIgniter4</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/index.html">Welcome to CodeIgniter4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/requirements.html">Server Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/credits.html">Credits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/psr.html">PSR Compliance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../license.html">License Agreement</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Installation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installing_composer.html">Composer Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing_manual.html">Manual Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html">Running Your App</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Worker Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html">Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelogs/index.html">Change Logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html">Upgrading From a Previous Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="repositories.html">CodeIgniter Repositories</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/first-app/index.html">Build Your First Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/api/index.html">Getting Started with REST APIs</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">CodeIgniter4 Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/structure.html">Application Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/mvc.html">Models, Views, and Controllers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/autoloader.html">Autoloading Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/services.html">Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/factories.html">Factories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/http.html">Working with HTTP Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/security.html">Security Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/goals.html">Design and Architectural Goals</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../general/index.html">General Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../general/configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/urls.html">CodeIgniter URLs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/helpers.html">Helper Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/common_functions.html">Global Functions and Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/logging.html">Logging Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/errors.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/caching.html">Web Page Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/ajax.html">AJAX Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/modules.html">Code Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/managing_apps.html">Managing your Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/environments.html">Handling Multiple Environments</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../incoming/index.html">Controllers and Routing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../incoming/routing.html">URI Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/controllers.html">Controllers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/filters.html">Controller Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/controller_attributes.html">Controller Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/auto_routing_improved.html">Auto Routing (Improved)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/message.html">HTTP Messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/request.html">Request Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/incomingrequest.html">IncomingRequest Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/content_negotiation.html">Content Negotiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/methodspoofing.html">HTTP Method Spoofing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/restful.html">RESTful Resource Handling</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../outgoing/index.html">Building Responses</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/views.html">Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_renderer.html">View Renderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_layouts.html">View Layouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_cells.html">View Cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_parser.html">View Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_decorators.html">View Decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/table.html">HTML Table Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/response.html">HTTP Responses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/api_responses.html">API Responses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/api_transformers.html">API Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/csp.html">Content Security Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/localization.html">Localization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/alternative_php.html">Alternate PHP Syntax for View Files</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../database/index.html">Working with Databases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database/examples.html">Quick Start: Usage Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/configuration.html">Database Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/connecting.html">Connecting to a Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/queries.html">Running Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/results.html">Generating Query Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/helpers.html">Query Helper Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/query_builder.html">Query Builder Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/transactions.html">Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/metadata.html">Getting Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/call_function.html">Custom Function Calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/events.html">Database Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/utilities.html">Database Utilities</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models/index.html">Modeling Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../models/model.html">Using CodeIgniter's Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/entities.html">Using Entity Classes</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dbmgmt/index.html">Managing Databases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/forge.html">Database Forge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/migration.html">Database Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/seeds.html">Database Seeding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/db_commands.html">Database Commands</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../libraries/index.html">Library Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../libraries/caching.html">Caching Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/cookies.html">Cookies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/cors.html">Cross-Origin Resource Sharing (CORS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/curlrequest.html">CURLRequest Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/email.html">Email Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/encryption.html">Encryption Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/files.html">Working with Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/file_collections.html">File Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/honeypot.html">Honeypot Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/images.html">Image Manipulation Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/pagination.html">Pagination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/publisher.html">Publisher</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/sessions.html">Session Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/throttler.html">Throttler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/time.html">Times and Dates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/typography.html">Typography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/uploaded_files.html">Working with Uploaded Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/uri.html">Working with URIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/user_agent.html">User Agent Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/validation.html">Validation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../helpers/index.html">Helpers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../helpers/array_helper.html">Array Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/cookie_helper.html">Cookie Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/date_helper.html">Date Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/filesystem_helper.html">Filesystem Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/form_helper.html">Form Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/html_helper.html">HTML Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/inflector_helper.html">Inflector Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/number_helper.html">Number Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/security_helper.html">Security Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/test_helper.html">Test Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/text_helper.html">Text Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/url_helper.html">URL Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/xml_helper.html">XML Helper</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing/overview.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/database.html">Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/fabricator.html">Generating Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/controllers.html">Controller Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/feature.html">HTTP Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/response.html">Testing Responses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/cli.html">Testing CLI Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/mocking.html">Mocking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/benchmark.html">Benchmarking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/debugging.html">Debugging Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/session_testing.html">Session Testing</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_overview.html">CLI Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_controllers.html">Running Controllers via CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/spark_commands.html">Spark Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_commands.html">Creating Spark Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_generators.html">CLI Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_library.html">CLI Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_signals.html">CLI Signals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_request.html">CLIRequest Class</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../extending/index.html">Extending CodeIgniter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../extending/core_classes.html">Creating Core System Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/common.html">Replacing Common Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/basecontroller.html">Extending the Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/authentication.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/composer_packages.html">Creating Composer Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/contributing.html">Contributing to CodeIgniter</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../libraries/official_packages.html">Official Packages</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CodeIgniter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
<a class="btn btn-neutral float-right" href="https://github.com/codeigniter4/CodeIgniter4/edit/develop/user_guide_src/source/installation/worker_mode.rst">Edit this page</a>

          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Installation</a></li>
      <li class="breadcrumb-item active">Worker Mode</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="worker-mode">
<h1>Worker Mode<a class="headerlink" href="#worker-mode" title="Permalink to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p>
<ul>
<li><p><a class="reference internal" href="#what-is-worker-mode" id="id2">What is Worker Mode?</a></p></li>
<li><p><a class="reference internal" href="#how-codeigniter-manages-state" id="id3">How CodeIgniter Manages State</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#getting-started" id="id4">Getting Started</a></p>
<ul>
<li><p><a class="reference internal" href="#installation" id="id5">Installation</a></p></li>
<li><p><a class="reference internal" href="#running-the-worker" id="id6">Running the Worker</a></p></li>
<li><p><a class="reference internal" href="#uninstalling" id="id7">Uninstalling</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performance-benchmarks" id="id8">Performance Benchmarks</a></p>
<ul>
<li><p><a class="reference internal" href="#worker-count-considerations" id="id9">Worker Count Considerations</a></p></li>
<li><p><a class="reference internal" href="#first-request-latency" id="id10">First Request Latency</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuration" id="id11">Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#configuration-options" id="id12">Configuration Options</a></p></li>
<li><p><a class="reference internal" href="#persistent-services" id="id13">Persistent Services</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#optimize-configuration" id="id14">Optimize Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#opcache-settings" id="id15">OPcache Settings</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#important-considerations" id="id16">Important Considerations</a></p>
<ul>
<li><p><a class="reference internal" href="#state-management" id="id17">State Management</a></p></li>
<li><p><a class="reference internal" href="#registrars" id="id18">Registrars</a></p></li>
<li><p><a class="reference internal" href="#memory-management" id="id19">Memory Management</a></p></li>
<li><p><a class="reference internal" href="#debugging" id="id20">Debugging</a></p></li>
<li><p><a class="reference internal" href="#session-and-cache-handlers" id="id21">Session and Cache Handlers</a></p></li>
<li><p><a class="reference internal" href="#database-connections" id="id22">Database Connections</a></p></li>
</ul>
</li>
</ul>
</nav>
<div class="versionadded">
<p><span class="versionmodified added">New in version 4.7.0.</span></p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Worker Mode is currently <strong>experimental</strong>. The only officially supported
worker implementation is <strong>FrankenPHP</strong>, which is backed by the PHP Foundation.</p>
</div>
<section id="introduction">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<section id="what-is-worker-mode">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">What is Worker Mode?</a><a class="headerlink" href="#what-is-worker-mode" title="Permalink to this heading"></a></h3>
<p>Worker Mode is a performance optimization feature that allows CodeIgniter to handle multiple
HTTP requests within the same PHP process, instead of starting a new process for each request
like traditional PHP-FPM does.</p>
<section id="traditional-php-vs-worker-mode">
<h4>Traditional PHP vs Worker Mode<a class="headerlink" href="#traditional-php-vs-worker-mode" title="Permalink to this heading"></a></h4>
<p><strong>Traditional PHP (PHP-FPM)</strong></p>
<p>In traditional PHP, each HTTP request goes through this cycle:</p>
<ol class="arabic simple">
<li><p>Web server receives request and spawns a new PHP process</p></li>
<li><p>PHP loads and parses all required files</p></li>
<li><p>Framework bootstraps: autoloader, configuration, services, routes</p></li>
<li><p>Database connections are established</p></li>
<li><p>Request is processed and response is sent</p></li>
<li><p>All connections are closed</p></li>
<li><p>PHP process terminates, freeing all memory</p></li>
</ol>
<p>This “shared nothing” architecture is simple and safe, but inefficient for high-traffic
applications because steps 2-4 repeat for every single request.</p>
<p><strong>Worker Mode</strong></p>
<p>In Worker Mode, the lifecycle changes dramatically:</p>
<ol class="arabic simple">
<li><p>Worker process starts and performs one-time initialization:</p>
<ul class="simple">
<li><p>Loads and parses all required files (cached in OPcache)</p></li>
<li><p>Bootstraps framework: autoloader, configuration, services, routes</p></li>
<li><p>Establishes database and cache connections</p></li>
</ul>
</li>
<li><p>For each incoming request:</p>
<ul class="simple">
<li><p>Reuses existing connections and cached resources</p></li>
<li><p>Resets only request-specific state (superglobals, request/response objects)</p></li>
<li><p>Processes request and sends response</p></li>
<li><p>Cleans up request-specific data</p></li>
</ul>
</li>
<li><p>Worker continues running, ready for the next request</p></li>
</ol>
<p>This approach eliminates redundant initialization work and connection overhead,
resulting in <strong>2-3x performance improvements</strong> for typical database-driven applications.</p>
</section>
</section>
<section id="how-codeigniter-manages-state">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">How CodeIgniter Manages State</a><a class="headerlink" href="#how-codeigniter-manages-state" title="Permalink to this heading"></a></h3>
<p>The key challenge in Worker Mode is preventing state from leaking between requests.
CodeIgniter handles this through several mechanisms:</p>
<dl class="simple">
<dt><strong>Services Reset</strong></dt><dd><p>Most services are destroyed and recreated for each request. Only services listed
in <code class="docutils literal notranslate"><span class="pre">$persistentServices</span></code> survive between requests.</p>
</dd>
<dt><strong>Factories Reset</strong></dt><dd><p>All Factories (Models, Config instances) are reset between requests,
ensuring fresh instances without stale data.</p>
</dd>
<dt><strong>Superglobals Isolation</strong></dt><dd><p>Request data (<code class="docutils literal notranslate"><span class="pre">$_GET</span></code>, <code class="docutils literal notranslate"><span class="pre">$_POST</span></code>, <code class="docutils literal notranslate"><span class="pre">$_SERVER</span></code>, etc.) is properly isolated
per request through the Superglobals service.</p>
</dd>
<dt><strong>Connection Persistence</strong></dt><dd><p>Database and cache connections are validated at request start and reused if healthy.
Unhealthy connections are automatically re-established.</p>
</dd>
</dl>
</section>
</section>
<section id="getting-started">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Getting Started</a><a class="headerlink" href="#getting-started" title="Permalink to this heading"></a></h2>
<section id="installation">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Installation</a><a class="headerlink" href="#installation" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Install FrankenPHP following the <a class="reference external" href="https://frankenphp.dev/">official documentation</a></p>
<p>You can use a static binary or Docker. Here, we will assume we use a static binary,
which can be <a class="reference external" href="https://github.com/php/frankenphp/releases/">downloaded directly</a>.</p>
</li>
<li><p>Install the Worker Mode template files using the spark command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">php spark worker:install</span>
</pre></div>
</div>
<p>This command creates two files:</p>
<ul class="simple">
<li><p><strong>Caddyfile</strong> - FrankenPHP configuration file with worker mode enabled</p></li>
<li><p><strong>public/frankenphp-worker.php</strong> - Worker entry point that handles the request loop</p></li>
</ul>
</li>
<li><p>Configure your worker settings in <strong>app/Config/WorkerMode.php</strong> if needed.
The defaults are recommended for most applications.</p></li>
</ol>
</section>
<section id="running-the-worker">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Running the Worker</a><a class="headerlink" href="#running-the-worker" title="Permalink to this heading"></a></h3>
<p>Start FrankenPHP using the generated Caddyfile:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">frankenphp run</span>
</pre></div>
</div>
<p>The server will start with worker mode enabled, handling requests through the worker entry point.</p>
<p>To run in the background (daemon mode):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">frankenphp start</span>
</pre></div>
</div>
</section>
<section id="uninstalling">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Uninstalling</a><a class="headerlink" href="#uninstalling" title="Permalink to this heading"></a></h3>
<p>To remove the Worker Mode template files:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">php spark worker:uninstall</span>
</pre></div>
</div>
<p>This removes the <strong>Caddyfile</strong> and <strong>public/frankenphp-worker.php</strong> files.</p>
</section>
</section>
<section id="performance-benchmarks">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Performance Benchmarks</a><a class="headerlink" href="#performance-benchmarks" title="Permalink to this heading"></a></h2>
<p>Worker Mode typically provides <strong>2-3x performance improvements</strong> for database-driven
applications. The actual gains depend on your application’s characteristics:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Scenario</p></th>
<th class="head"><p>Expected Improvement</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Simple endpoints</strong></p></td>
<td><p>Applications returning minimal JSON responses show modest
improvements (10-30%), as there’s little bootstrap overhead
to eliminate.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Database queries</strong></p></td>
<td><p>Endpoints performing database queries typically see <strong>2-3x</strong>
improvements from connection reuse and reduced initialization
overhead.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Complex bootstrap</strong></p></td>
<td><p>Applications with many services, routes, or configuration see
the largest gains, as this overhead is eliminated entirely.</p></td>
</tr>
</tbody>
</table>
<section id="worker-count-considerations">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Worker Count Considerations</a><a class="headerlink" href="#worker-count-considerations" title="Permalink to this heading"></a></h3>
<p>Total throughput scales with worker count. Match worker count to your typical concurrency
patterns and available CPU cores. Too few workers limit concurrency; too many waste memory.</p>
</section>
<section id="first-request-latency">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">First Request Latency</a><a class="headerlink" href="#first-request-latency" title="Permalink to this heading"></a></h3>
<p>The initial request to each worker is slower due to bootstrap and connection establishment.
Subsequent requests benefit from cached resources and persistent connections.</p>
</section>
</section>
<section id="configuration">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>All worker mode configuration is managed through the <strong>app/Config/WorkerMode.php</strong> file.</p>
<section id="configuration-options">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Configuration Options</a><a class="headerlink" href="#configuration-options" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>$persistentServices</strong></p></td>
<td><p>array</p></td>
<td><p>Services that persist across requests and are not reset. Services not
in this list are destroyed after each request to prevent state leakage.
Default: <code class="docutils literal notranslate"><span class="pre">['autoloader',</span> <span class="pre">'locator',</span> <span class="pre">'exceptions',</span> <span class="pre">'commands',</span>
<span class="pre">'codeigniter',</span> <span class="pre">'superglobals',</span> <span class="pre">'routes',</span> <span class="pre">'cache']</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><strong>$forceGarbageCollection</strong></p></td>
<td><p>bool</p></td>
<td><p>Whether to force garbage collection after each request.
<code class="docutils literal notranslate"><span class="pre">true</span></code> (default, recommended): Prevents memory leaks.
<code class="docutils literal notranslate"><span class="pre">false</span></code>: Relies on PHP’s automatic garbage collection.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="persistent-services">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Persistent Services</a><a class="headerlink" href="#persistent-services" title="Permalink to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">$persistentServices</span></code> array controls which services survive between requests.
The default configuration includes:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Service</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">autoloader</span></code></p></td>
<td><p>PSR-4 autoloading configuration. Safe to persist as class maps don’t change.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">locator</span></code></p></td>
<td><p>File locator for finding framework files. Caches file paths for performance.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exceptions</span></code></p></td>
<td><p>Exception handler. Stateless, safe to reuse.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">commands</span></code></p></td>
<td><p>CLI commands registry. Only used during worker startup.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">codeigniter</span></code></p></td>
<td><p>Main application instance. Orchestrates the request/response cycle.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">superglobals</span></code></p></td>
<td><p>Superglobals wrapper. Properly isolated per request internally.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">routes</span></code></p></td>
<td><p>Router configuration. Route definitions don’t change between requests.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cache</span></code></p></td>
<td><p>Cache service. Maintains connections to cache backends (Redis, Memcached).</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Adding services to <code class="docutils literal notranslate"><span class="pre">$persistentServices</span></code> without understanding their
state management can cause data leakage between requests. Only persist services
that are truly stateless or manage their own request isolation.</p>
</div>
</section>
</section>
<section id="optimize-configuration">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Optimize Configuration</a><a class="headerlink" href="#optimize-configuration" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">app/Config/Optimize.php</span></code> configuration options (Config Caching and File Locator Caching)
should <strong>NOT</strong> be used with Worker Mode.</p>
<p>These optimizations were designed for traditional PHP where each request starts fresh. In Worker
Mode, the persistent process already provides these benefits naturally, and enabling them can
cause issues with stale data.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not enable <code class="docutils literal notranslate"><span class="pre">$configCacheEnabled</span></code> or <code class="docutils literal notranslate"><span class="pre">$locatorCacheEnabled</span></code> in
<strong>app/Config/Optimize.php</strong> when using Worker Mode.</p>
</div>
<section id="opcache-settings">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">OPcache Settings</a><a class="headerlink" href="#opcache-settings" title="Permalink to this heading"></a></h3>
<p>Worker Mode benefits significantly from OPcache. Ensure it’s enabled and properly configured:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="na">opcache.enable</span><span class="o">=</span><span class="s">1</span>
<span class="na">opcache.memory_consumption</span><span class="o">=</span><span class="s">256</span>
<span class="na">opcache.max_accelerated_files</span><span class="o">=</span><span class="s">20000</span>
<span class="na">opcache.validate_timestamps</span><span class="o">=</span><span class="s">0</span><span class="w">  </span><span class="c1">; In production only</span>
</pre></div>
</div>
</section>
</section>
<section id="important-considerations">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Important Considerations</a><a class="headerlink" href="#important-considerations" title="Permalink to this heading"></a></h2>
<section id="state-management">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">State Management</a><a class="headerlink" href="#state-management" title="Permalink to this heading"></a></h3>
<p>Since the PHP process persists across requests, careful attention to state management is essential:</p>
<ul class="simple">
<li><p><strong>Avoid static properties</strong> for request-specific data, as these persist between requests</p></li>
<li><p><strong>Be cautious with singletons</strong> that might retain request state</p></li>
<li><p><strong>Clean up resources</strong> like file handles and database cursors after each request</p></li>
<li><p><strong>Don’t store user data</strong> in class properties that persist across requests</p></li>
</ul>
</section>
<section id="registrars">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Registrars</a><a class="headerlink" href="#registrars" title="Permalink to this heading"></a></h3>
<p>Config registrars (<code class="docutils literal notranslate"><span class="pre">Config/Registrar.php</span></code> files) work correctly in Worker Mode.
Registrar files are discovered once when the worker starts, and registrar logic is applied
every time a Config class is instantiated. Each request gets a fresh Config instance with
registrars applied.</p>
</section>
<section id="memory-management">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Memory Management</a><a class="headerlink" href="#memory-management" title="Permalink to this heading"></a></h3>
<p>Monitor memory usage:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ps aux | grep frankenphp</span>
</pre></div>
</div>
<p>If memory grows continuously:</p>
<ul class="simple">
<li><p>Verify garbage collection is enabled (<code class="docutils literal notranslate"><span class="pre">$forceGarbageCollection</span> <span class="pre">=</span> <span class="pre">true</span></code>)</p></li>
<li><p>Ensure resources are properly closed after use</p></li>
<li><p>Unset large objects when no longer needed</p></li>
<li><p>Check for circular references that prevent garbage collection</p></li>
</ul>
</section>
<section id="debugging">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Debugging</a><a class="headerlink" href="#debugging" title="Permalink to this heading"></a></h3>
<p>Worker Mode can make debugging more challenging since the process persists across requests:</p>
<ul class="simple">
<li><p><strong>Restart workers after code changes</strong> - workers don’t auto-reload modified files</p></li>
<li><p><strong>Check logs</strong> in <strong>writable/logs/</strong> for connection and state-related issues</p></li>
<li><p><strong>Use logging liberally</strong> to trace request flow across the persistent process</p></li>
</ul>
</section>
<section id="session-and-cache-handlers">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Session and Cache Handlers</a><a class="headerlink" href="#session-and-cache-handlers" title="Permalink to this heading"></a></h3>
<p><strong>File-based handlers</strong> may experience file locking contention between workers.
For production environments, consider using:</p>
<ul class="simple">
<li><p><strong>Redis</strong> or <strong>Memcached</strong> for sessions and cache</p></li>
<li><p>These provide better concurrency and automatic connection persistence</p></li>
</ul>
</section>
<section id="database-connections">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Database Connections</a><a class="headerlink" href="#database-connections" title="Permalink to this heading"></a></h3>
<p>Database connections are automatically managed:</p>
<ul class="simple">
<li><p>Connections persist across requests for performance</p></li>
<li><p>Connections are validated at the start of each request</p></li>
<li><p>Failed connections are automatically re-established</p></li>
<li><p>Uncommitted transactions are automatically rolled back with a warning logged</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="running.html" class="btn btn-neutral float-left" title="Running Your App" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="troubleshooting.html" class="btn btn-neutral float-right" title="Troubleshooting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2026 CodeIgniter Foundation.
      <span class="lastupdated">Last updated on Feb 01, 2026.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>