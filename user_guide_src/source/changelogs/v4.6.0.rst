#############
Version 4.6.0
#############

Release Date: Unreleased

**4.6.0 release of CodeIgniter4**

.. contents::
    :local:
    :depth: 3

**********
Highlights
**********

- TBD

********
BREAKING
********

Behavior Changes
================

.. _v460-behavior-changes-exceptions:

Exceptions
----------

The exception class has been redesigned. See :ref:`exception-design` for details.
The following breaking changes have been made accordingly:

- ``Validation::setRule()`` now throws ``CodeIgniter\Exceptions\InvalidArgumentException``
  instead of ``TypeError``.

- ``CriticalError`` now extends ``CodeIgniter\Exceptions\RuntimeException``
  instead of ``Error``.
- ``DatabaseException`` now extends ``CodeIgniter\Exceptions\RuntimeException``
  instead of ``Error``.
- ``ConfigException`` now extends ``CodeIgniter\Exceptions\RuntimeException``
  instead of ``CodeIgniter\Exceptions\CriticalError``.
- ``TestException`` now extends ``CodeIgniter\Exceptions\LogicException``
  instead of ``CodeIgniter\Exceptions\CriticalError``.

Filters Changes
---------------

The ``Filters`` class has been changed to allow multiple runs of the same filter
with different arguments in before or after. See
:ref:`Upgrading Guide <upgrade-460-filters-changes>` for details.

.. _v460-interface-changes:

Interface Changes
=================

.. note:: As long as you have not extended the relevant CodeIgniter core classes
    or implemented these interfaces, all these changes are backward compatible
    and require no intervention.

- **Router:** The following methods have been added in ``RouteCollectionInterface``:

    - ``getDefaultNamespace()``
    - ``getRoutesOptions()``
    - ``setHTTPVerb()``
    - ``isFiltered()``
    - ``getFiltersForRoute()``

.. _v460-method-signature-changes:

Method Signature Changes
========================

- **Router:** The constructor of the ``DefinedRouteCollector`` has been
  changed. The ``RouteCollection`` typehint has been changed to ``RouteCollectionInterface``.
- **View:** The return type of the ``renderSection()`` method has been
  changed to ``string``, and now the method does not call ``echo``.

.. _v460-removed-deprecated-items:

Removed Deprecated Items
========================

- **API:** The deprecated ``failValidationError()`` method in ``CodeIgniter\API\ResponseTrait``
  has been removed. Use ``failValidationErrors()`` instead.
- **HTTP:** The deprecated ``getReason()`` method in ``CodeIgniter\HTTP\Response``
  and ``ResponseInterface`` has been removed. Use ``getReasonPhrase()`` instead.
- **Logger:** The deprecated ``CodeIgniter\Log\Logger::cleanFilenames()`` and
  ``CodeIgniter\Test\TestLogger::cleanup()`` have been removed. Use the
  ``clean_path()`` function instead.

************
Enhancements
************

Exceptions
==========

The exception class has been redesigned. See :ref:`exception-design` for details.
The following new Exception classes have been added accordingly:

- ``CodeIgniter\Exceptions\LogicException``
- ``CodeIgniter\Exceptions\RuntimeException``
- ``CodeIgniter\Exceptions\BadFunctionCallException``
- ``CodeIgniter\Exceptions\BadMethodCallException``
- ``CodeIgniter\Exceptions\InvalidArgumentException``

The following new Exception interfaces have been added:

- ``CodeIgniter\Files\Exceptions\ExceptionInterface``
- ``CodeIgniter\HTTP\Exceptions\ExceptionInterface``
- ``CodeIgniter\Router\Exceptions\ExceptionInterface``

Commands
========

- The ``spark routes`` and ``spark filter:check`` commands now display filter
  arguments.
- The ``spark filter:check`` command now displays filter classnames.

Testing
=======

Database
========

Query Builder
-------------

Forge
-----

Others
------

- Added a new configuration ``foundRows`` for MySQLi to use ``MYSQLI_CLIENT_FOUND_ROWS``.
- Added the ``BaseConnection::resetTransStatus()`` method to reset the transaction
  status. See :ref:`transactions-resetting-transaction-status` for details.

Model
=====

Libraries
=========

- **FileCollection:** Added ``retainMultiplePatterns()`` to ``FileCollection`` class.
  See :ref:`FileCollection::retainMultiplePatterns() <file-collections-retain-multiple-patterns>`.
- **Validation:** 
    - Added ``min_dims`` validation rule to ``FileRules`` class. See :ref:`Validation <rules-for-file-uploads>`.
    - Added ``required_if`` validation rule to ``Rules`` class. See :ref:`Validation <rules-for-general-use>`.

Helpers and Functions
=====================

Others
======

- **Filters:** Now you can execute a filter more than once with the different
  arguments in before or after.
- **Services:** Added ``BaseService::resetServicesCache()`` method to reset
  the services cache. See :ref:`resetting-services-cache`.

***************
Message Changes
***************

- Added ``Validation.min_dims`` message
- Added ``Validation.required_if`` message

*******
Changes
*******

Exceptions
==========

The exception classes have been redesigned. See :ref:`exception-design` for details.
The following changes have been made accordingly:

- The ``deleteMatching()`` method in Cache Handler classes now throws
  ``CodeIgniter\Exceptions\BadMethodCallException`` instead of ``Exception``.
- ``Cache\ResponseCache::get()`` now throws ``CodeIgniter\Exceptions\RuntimeException``
  instead of ``Exception``.
- Classes that threw ``RuntimeException`` have been changed to throw
  ``CodeIgniter\Exceptions\RuntimeException``.
- Classes that threw ``InvalidArgumentException`` have been changed to throw
  ``CodeIgniter\Exceptions\InvalidArgumentException``.
- Classes that threw ``LogicException`` have been changed to throw
  ``CodeIgniter\Exceptions\LogicException``.
- Classes that threw ``BadMethodCallException`` have been changed to throw
  ``CodeIgniter\Exceptions\BadMethodCallException``.
- Classes that threw ``BadFunctionCallException`` have been changed to throw
  ``CodeIgniter\Exceptions\BadFunctionCallException``.

- ``RedirectException`` now extends ``CodeIgniter\Exceptions\RuntimeException``
  instead of ``Exception``.
- ``PageNotFoundException`` now extends ``CodeIgniter\Exceptions\RuntimeException``
  instead of ``OutOfBoundsException``.

************
Deprecations
************

- **Filters:**
    - The properties ``$arguments`` and ``$argumentsClass`` of ``Filters`` have
      been deprecated. No longer used.
    - The ``Filters::getArguments()`` method has been deprecated. No longer used.

**********
Bugs Fixed
**********

See the repo's
`CHANGELOG.md <https://github.com/codeigniter4/CodeIgniter4/blob/develop/CHANGELOG.md>`_
for a complete list of bugs fixed.
